pipeline{
    agent any
    tools{
        maven 'maven'
    }
     environment {
    DEPLOY_ENV = 'staging'
    GIT_REPO_URL = 'https://github.com/AlphaMale01/web-app.git'
  }
    stages{
        stage('cloning git'){
			steps{
				echo 'cloning starts'
                git 'https://github.com/AlphaMale01/web-app.git'
			}
		}
		stage('Building with maven'){
			steps{
				echo 'Building starts'
                sh "mvn package"
			}
		}
    stage('Seeking Approval'){
      steps{
        echo 'Seeking approval'
        echo 'Sending email to team lead'
        timeout(time: 5, unit: "DAYS"){
          input message: 'Approve to deploy to sonarqube'
        }
      }
    }
		stage('Testing with Sonarqube'){
		    steps{
		      echo 'Testing starts'
		      sh "mvn sonar:sonar"
		    }
		}
		stage('Deploying to Nexus'){
		    steps{
		        echo 'Deploying starts'
		        sh "mvn deploy"
		    }
		}
    }
  post {
    always {
      echo "I am done"
    }
    success {
      echo "Deploying to ${env.DEPLOY_ENV} Nexus successful"
    }
    failure {
      echo "Deploying to ${env.DEPLOY_ENV} failed"
    }
  }
}
    
